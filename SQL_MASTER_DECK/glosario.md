# ü¶Ñ SQL FUNDAMENTOS ‚Äî DICCIONARIO DEFINITIVO  
**Archivo sugerido:** `sql_fundamentos_definitivo.md`  
**Alcance:** Fundamentos completos y precisos de SQL y modelado de datos. Formato Markdown listo para VS Code.  
**Nota:** Solo FUNDAMENTOS (definiciones, ejemplos m√≠nimos, diagramas, buenas pr√°cticas, ejercicios y errores comunes).  

---

## √çNDICE
1. Resumen ejecutivo  
2. Conceptos b√°sicos (definiciones precisas)  
3. Tipos de datos (tabla pr√°ctica)  
4. Sentencias esenciales ‚Äî DDL / DML / DCL / TCL (qu√© significa cada sigla)  
5. Cl√°usulas SELECT y operadores (tabla + orden de ejecuci√≥n)  
6. Joins, self-join y subconsultas (ejemplos)  
7. Vistas, √≠ndices, stored procedures y triggers (qu√© y cu√°ndo)  
8. Constraints (tabla con ejemplos y ON DELETE/UPDATE)  
9. Modelado dimensional ‚Äî fundamentos (facts / dims / surrogate keys / granularidad)  
10. Diagramas ER ‚Äî s√≠mbolos, l√≠neas, colores y lectura (completo)  
11. Ejemplos completos y snippets SQL (m√≠nimos y claros)  
12. Buenas pr√°cticas (checklist)  
13. Glosario alfab√©tico corto (siglas y t√©rminos)  
14. Lectura r√°pida (plantilla DER)  
15. Anexo A: 10 ejercicios pr√°cticos (con respuestas clave)  
16. Anexo B: Errores comunes y c√≥mo evitarlos

---

## 1 ‚Äî RESUMEN EJECUTIVO
Documento de referencia compacto y exhaustivo sobre fundamentos de SQL y modelado de datos: definiciones limpias, tipos de datos, sentencias y siglas, cl√°usulas, joins, subconsultas, vistas, √≠ndices, constraints, modelado dimensional (facts/dimensions), diagramas ER (s√≠mbolos y lectura), ejemplos listos para ejecutar y checklist de buenas pr√°cticas. Ideal para clases, gu√≠as r√°pidas o consulta t√©cnica.

---

## 2 ‚Äî CONCEPTOS B√ÅSICOS (DEFINICIONES PRECISAS)

- **Base de datos**: Conjunto organizado de tablas y objetos (√≠ndices, vistas, procedimientos) que permite almacenar y consultar informaci√≥n estructurada.  
- **Tabla (Entidad)**: Estructura compuesta por columnas (atributos) y filas (registros).  
- **Columna (Atributo)**: Campo con nombre y tipo de dato que describe un atributo de la entidad.  
- **Fila (Registro / Tupla)**: Instancia completa de valores para todas/some columnas de la tabla.  
- **Primary Key (PK)**: Columna o conjunto de columnas cuyo valor identifica **un√≠vocamente** cada fila en la tabla; no admite NULL y debe ser estable.  
- **Foreign Key (FK)**: Columna (o conjunto) en una tabla que referencia una PK (o UNIQUE) de otra tabla para mantener integridad referencial. Una FK garantiza que el valor exista en la tabla referenciada (o sea NULL si est√° permitido).  
- **√çndice (Index)**: Estructura auxiliar que acelera b√∫squedas y ordenaciones; afecta rendimiento de escritura.  
- **Vista (View)**: Consulta almacenada que se consulta como una tabla virtual; no necesariamente almacena datos (salvo vistas materializadas).  
- **Transacci√≥n**: Conjunto de operaciones que se ejecutan como una unidad; cumple propiedades **ACID** (Atomicidad, Consistencia, Aislamiento, Durabilidad).  
- **Normalizaci√≥n**: Conjunto de reglas y formas normales (1NF, 2NF, 3NF‚Ä¶) destinadas a reducir redundancia y anomal√≠as de actualizaci√≥n.  
- **Denormalizaci√≥n**: Deliberada duplicaci√≥n de datos para mejorar rendimiento de consulta.  
- **Granularidad**: Nivel de detalle representado por un registro (por ejemplo: por transacci√≥n, por l√≠nea de pedido, por d√≠a). Define la ‚Äúunidad‚Äù en la tabla de hechos.  
- **Cardinalidad**: Cantidad de instancias que participan en una relaci√≥n entre entidades: 1:1, 1:N, N:M.  
- **Surrogate Key**: Clave artificial (por ejemplo `INT AUTO_INCREMENT` o `UUID`) creada para identificar filas internamente; no tiene significado del mundo real.  
- **Natural Key**: Clave derivada de datos del dominio (p.ej. n√∫mero de expediente); tiene significado contextual.

---

## 3 ‚Äî TIPOS DE DATOS (PR√ÅCTICOS)

| Categor√≠a                           | Tipos (ejemplos) | Uso recomendado |
|-------------------------------------|------------------|-----------------|
| Num√©ricos | `INT`, `BIGINT`, `DECIMAL(p,s)`, `NUMERIC(p,s)`, `FLOAT` | `DECIMAL/NUMERIC` para montos monetarios; `INT/BIGINT` para IDs/contadores. Evitar `FLOAT` para finanzas. |
| Texto | `CHAR(n)`, `VARCHAR(n)`, `TEXT` | `VARCHAR` para la mayor√≠a; `TEXT` para textos largos. |
| Fecha / Hora | `DATE`, `TIME`, `DATETIME`, `TIMESTAMP` | `DATE` para fechas, `TIMESTAMP` para eventos con zona/hora. |
| Booleano | `BOOLEAN`, `TINYINT(1)` | Flags (`is_active`). |
| Binario | `BLOB`, `BYTEA` | Archivos binarios/imagenes. |
| Estructurado | `JSON`, `JSONB` | Datos semiestructurados (p. ej. arrays/objetos). |
| Identificadores | `UUID`, `CHAR`, `VARCHAR` | Identificadores distribuidos o externos. |

**Consejo:** define precisi√≥n (`DECIMAL(12,2)`) seg√∫n necesidades; evita `TEXT` como clave.

---

## 4 ‚Äî SENTENCIAS ESENCIALES ‚Äî DDL / DML / DCL / TCL (¬øQU√â SIGNIFICA CADA SIGLA?)

- **DDL ‚Äî Data Definition Language** (Lenguaje de Definici√≥n de Datos)  
  Comandos: `CREATE`, `ALTER`, `DROP`, `TRUNCATE`.  
  Prop√≥sito: crear y modificar estructuras de la BD (tablas, √≠ndices, vistas).

- **DML ‚Äî Data Manipulation Language** (Lenguaje de Manipulaci√≥n de Datos)  
  Comandos: `SELECT`, `INSERT`, `UPDATE`, `DELETE`, `MERGE`.  
  Prop√≥sito: leer y modificar datos en las tablas.

- **DCL ‚Äî Data Control Language** (Lenguaje de Control de Datos)  
  Comandos: `GRANT`, `REVOKE`.  
  Prop√≥sito: gesti√≥n de permisos y seguridad.

- **TCL ‚Äî Transaction Control Language** (Lenguaje de Control de Transacciones)  
  Comandos: `BEGIN` / `START TRANSACTION`, `COMMIT`, `ROLLBACK`, `SAVEPOINT`.  
  Prop√≥sito: controlar la atomicidad y consistencia de conjuntos de operaciones.

---

## 5 ‚Äî CL√ÅUSULAS `SELECT` Y OPERADORES (TABLA + ORDEN DE EJECUCI√ìN)

### Orden l√≥gico (ejecuci√≥n conceptual)
| Orden l√≥gico | Cl√°usula |
|--------------|----------|
| 1 | `FROM` / `JOIN` |
| 2 | `WHERE` |
| 3 | `GROUP BY` |
| 4 | `HAVING` |
| 5 | `SELECT` |
| 6 | `ORDER BY` |
| 7 | `LIMIT` / `OFFSET` |

### Cl√°usulas y operadores √∫tiles
| Cl√°usula / Operador | Uso |
|---------------------|-----|
| `SELECT` | Selecciona columnas/expresiones. |
| `FROM` | Indica tabla(s) o vista(s) de origen. |
| `WHERE` | Filtra filas por condiciones booleanas. |
| `GROUP BY` | Agrupa filas para agregaci√≥n. |
| `HAVING` | Filtra grupos (despu√©s de agrupar). |
| `ORDER BY` | Ordena resultados. |
| `LIMIT` / `OFFSET` | Controla n√∫mero de filas devueltas. |
| `DISTINCT` | Elimina duplicados. |
| `AS` | Alias para columnas o tablas (`col AS alias`). |
| `CASE WHEN` | Expresi√≥n condicional en SELECT. |
| `IN`, `BETWEEN`, `LIKE`, `IS NULL` | Filtros pr√°cticos. |
| `EXISTS` | Verifica existencia de filas en subconsulta. |

**Ejemplo `CASE`:**
```sql
SELECT nombre,
  CASE
    WHEN sueldo >= 50000 THEN 'alto'
    WHEN sueldo >= 30000 THEN 'medio'
    ELSE 'bajo'
  END AS rango_sueldo
FROM empleados;
```
## 6 ‚Äî JOINS, SELF-JOIN Y SUBCONSULTAS (EJEMPLOS)
INNER JOIN (solo coincidencias)
```sql
SELECT c.nombre, p.total
FROM clientes c
INNER JOIN pedidos p ON c.id = p.cliente_id;
```
LEFT JOIN (todos de la izquierda)
```sql
SELECT c.nombre, p.total
FROM clientes c
LEFT JOIN pedidos p ON c.id = p.cliente_id;
```
RIGHT JOIN / FULL JOIN (dependen del SGBD)
```sql
-- FULL OUTER JOIN (si el SGBD lo soporta)
SELECT a.*, b.*
FROM A
FULL JOIN B ON A.id = B.a_id;
```
SELF JOIN (una tabla relacionada consigo misma)
```sql
-- Ej: empleados y su jefe (empleado.manager_id referencia empleados.id)
SELECT e.nombre AS empleado, m.nombre AS jefe
FROM empleados e
LEFT JOIN empleados m ON e.manager_id = m.id;
```
Subconsulta (escalares / IN / EXISTS)
```sql
-- IN
SELECT nombre FROM clientes
WHERE id IN (SELECT cliente_id FROM pedidos WHERE total > 100);

-- EXISTS
SELECT nombre FROM clientes c
WHERE EXISTS (SELECT 1 FROM pedidos p WHERE p.cliente_id = c.id AND p.total > 100);
```
N:M con tabla intermedia
```sql
CREATE TABLE producto_pedido (
  producto_id INT NOT NULL,
  pedido_id INT NOT NULL,
  cantidad INT NOT NULL,
  PRIMARY KEY (producto_id, pedido_id),
  FOREIGN KEY (producto_id) REFERENCES productos(id),
  FOREIGN KEY (pedido_id) REFERENCES pedidos(id)
);
```
## 7 ‚Äî VISTAS, √çNDICES, STORED PROCEDURES Y TRIGGERS
Vistas
- Qu√©: consultas guardadas usadas como tablas virtuales.
- Cu√°ndo: simplificar consultas frecuentes, encapsular l√≥gica.
- Nota: vistas normales no mejoran rendimiento; las materializadas s√≠, dependiendo del SGBD.

```sql
CREATE VIEW v_clientes_activos AS
SELECT id, nombre, email FROM clientes WHERE activo = 1;
```
√çndices
- Qu√©: estructuras (B-tree, hash) que aceleran b√∫squedas.
- Cu√°ndo: columnas usadas en WHERE, JOIN, ORDER BY.
- Precauci√≥n: aumentan coste de INSERT/UPDATE/DELETE; elegir columnas selectivas.

```sql
CREATE INDEX idx_clientes_email ON clientes(email);
```
## 8 ‚Äî CONSTRAINTS (TABLA CON EJEMPLOS Y ON DELETE / ON UPDATE)
Constraint	Descripci√≥n	Ejemplo
NOT NULL	No permite NULL	nombre VARCHAR(100) NOT NULL
UNIQUE	Valores √∫nicos	email VARCHAR(150) UNIQUE
PRIMARY KEY	Identificador √∫nico	id INT PRIMARY KEY
FOREIGN KEY	Referencia a otra tabla	FOREIGN KEY (cliente_id) REFERENCES clientes(id)
CHECK	Condici√≥n por fila	CHECK (edad >= 18)
DEFAULT	Valor por defecto	fecha_creacion DATE DEFAULT CURRENT_DATE

Opciones de integridad referencial:

```sql
Copiar c√≥digo
FOREIGN KEY (cliente_id)
  REFERENCES clientes(id)
  ON DELETE CASCADE
  ON UPDATE RESTRICT;
```
- ON DELETE CASCADE: al borrar la fila referenciada, borrar filas dependientes.
- ON DELETE SET NULL: al borrar la fila referenciada, establecer NULL en la FK (si permite NULL).
- ON UPDATE CASCADE: propaga actualizaciones de clave.
- RESTRICT / NO ACTION: impide la operaci√≥n si hay dependientes.

## 9 ‚Äî MODELADO DIMENSIONAL ‚Äî FUNDAMENTOS (FACTS / DIMS / SURROGATE / GRANULARIDAD)

Definiciones (precisas)

- Tabla de Hechos (Fact table): tabla central en un data warehouse que almacena medidas cuantitativas (m√©tricas) y claves hacia tablas de dimensi√≥n. Cada fila representa un evento o transacci√≥n al nivel de granularidad definido. Ejemplos de medidas: monto, cantidad.

- Tabla de Dimensi√≥n (Dimension table): tabla que describe entidades (atributos contextuales) utilizadas para filtrar y agrupar hechos: dim_cliente, dim_producto, dim_tiempo. Contienen atributos descriptivos (nombre, categor√≠a).

- Granularidad (Granularity): la unidad elemental que representa una fila en la tabla de hechos (p. ej. "una l√≠nea de factura", "una transacci√≥n", "un click"). Definir granularidad es crucial: determina volumen y tipo de an√°lisis posible.

- Surrogate Key: clave artificial en dimensiones (p. ej. cliente_sk) usada en el data warehouse para asegurar estabilidad, independencia de cambios en claves naturales.

- Natural Key: clave del sistema operacional que tiene significado en el negocio (p. ej. cliente_id del OLTP).

- Conformed Dimension: dimensi√≥n compartida entre m√∫ltiples hechos para permitir an√°lisis consistentes.

- Grain: sin√≥nimo de granularidad; especifica exactamente qu√© representa cada registro en la fact table.

## Modelos (diferencias)
- Star Schema: fact table central y dimensiones desnormalizadas (atributos repetidos dentro de la dimensi√≥n). Ventaja: consultas simples y r√°pidas; desventaja: cierto almacenamiento extra.

- Snowflake Schema: dimensiones normalizadas en m√∫ltiples tablas relacionadas. Ventaja: menos redundancia; desventaja: m√°s joins y consultas m√°s complejas.

- Modelo h√≠brido: combinaci√≥n seg√∫n necesidades (desnormalizar atributos de alta consulta).

## 10 ‚Äî DIAGRAMAS ER ‚Äî S√çMBOLOS, L√çNEAS, COLORES Y LECTURA (COMPLETO)
**S√≠mbolos y significados**
üìò S√≠mbolos en Diagramas ER:

- üü¶ Rect√°ngulo: tabla / entidad
- üü¢ √ìvalo / Elipse: atributo (menos usado en diagramas f√≠sicos)
- üîë PK: Primary Key (identificador √∫nico)
- üî∏ FK: Foreign Key (referencia a PK / UNIQUE)
- üíé Rombo / Diamante: relaci√≥n (modelos conceptuales)
- ü™∂ Crow‚Äôs Foot (pata de cuervo): notaci√≥n de cardinalidad ‚Äî muestra ‚Äúmuchos‚Äù
- ‚ûñ L√≠nea s√≥lida: relaci√≥n obligatoria (participaci√≥n total)
- L√≠nea punteada: relaci√≥n opcional (participaci√≥n parcial) -----------
- üîÅ Flecha simple: direcci√≥n de referencia (opcional, seg√∫n notaci√≥n)
- üè∑Ô∏è Etiqueta en l√≠nea: describe multiplicidad (1, 0..1, 1..*, *, etc.)

**Cardinalidad y opcionalidad (c√≥mo leer)**
- 1 : 1 ‚Üí cada fila A corresponde a una fila B y viceversa.
- 1 : N (1..*) ‚Üí una fila A puede relacionarse con muchas filas B; cada B se relaciona con una sola A.
- N : M (M:N) ‚Üí m√∫ltiples A pueden relacionarse con m√∫ltiples B; requiere tabla intermedia.
- Opcionalidad: 0..1 (0 o 1), 1 (exactamente 1), 0..* (cero o muchos), 1..* (uno o muchos).

*Convenci√≥n de colores (sugerida ‚Äî no est√°ndar)**
- üü¢ Verde ‚Üí relaci√≥n bien definida / FK consistente.
- üü† Naranja ‚Üí relaci√≥n parcial / opcional / revisi√≥n.
- üî¥ Rojo ‚Üí error / inconsistencia (tipos distintos, FK sin PK).
- üîµ Azul ‚Üí tablas puente / cat√°logo.
- üü° Amarillo ‚Üí tabla de hechos (fact).

Ejemplos ASCII
1 : N

```sql
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   1    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CLIENTES  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ<‚îÇ  PEDIDOS   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```
N : M (con tabla intermedia)
```sql
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   N    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   M    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PRODUCTOS‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ<‚îÇ PRODUCTO_PEDIDOS ‚îÇ>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ PEDIDOS  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```
Opcionalidad (punteada = opcional)
```sql
CLIENTES . . .> DIRECCIONES
(Cliente puede no tener direcci√≥n)
```
11 ‚Äî EJEMPLOS COMPLETOS Y SNIPPETS SQL (M√çNIMOS Y CLAROS)
```sql

-- Crear tablas principales
CREATE TABLE clientes (
  id INT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  email VARCHAR(150) UNIQUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE pedidos (
  id INT PRIMARY KEY,
  cliente_id INT NOT NULL,
  fecha DATE,
  total DECIMAL(12,2),
  FOREIGN KEY (cliente_id) REFERENCES clientes(id) ON DELETE CASCADE
);

-- Insertar
INSERT INTO clientes (id, nombre, email) VALUES (1, 'Ana', 'ana@example.com');

-- Consultar con join y alias
SELECT c.nombre AS cliente, p.total AS importe
FROM clientes c
LEFT JOIN pedidos p ON c.id = p.cliente_id
WHERE p.total > 100
ORDER BY p.total DESC
LIMIT 10;

-- Agregaci√≥n y CASE
SELECT cliente_id,
       COUNT(*) AS total_pedidos,
       SUM(total) AS suma_total,
       AVG(total) AS promedio,
       CASE WHEN SUM(total) > 10000 THEN 'VIP' ELSE 'NORMAL' END AS categoria
FROM pedidos
GROUP BY cliente_id
HAVING COUNT(*) > 5;
```
12 ‚Äî BUENAS PR√ÅCTICAS (CHECKLIST R√ÅPIDO)
```sql
‚úÖ Nombres claros y consistentes: snake_case (p.ej. clientes, fact_ventas).
‚úÖ Definir PK y FK desde dise√±o. Mantener tipos coherentes entre FK y PK
‚úÖ Usar DECIMAL para dinero; evitar FLOAT en finanzas.
‚úÖ Evitar SELECT * en producci√≥n; seleccionar columnas necesarias.
‚úÖ A√±adir created_at y updated_at en tablas transaccionales.
‚úÖ Indexar columnas usadas en JOIN/WHERE/ORDER BY con criterio.
‚úÖ Documentar diagrama ER, convenciones de colores y leyenda.
‚úÖ Versionar migraciones y mantener scripts idempotentes.
‚úÖ Probar integridad con datos de muestra y migraciones en entorno de staging.
‚úÖ Controlar accesos con roles y GRANT m√≠nimos necesarios.
```
13 ‚Äî GLOSARIO ALFAB√âTICO CORTO
- ACID: Atomicidad, Consistencia, Aislamiento, Durabilidad (propiedades de transacciones).
- DDL: Data Definition Language.
- DML: Data Manipulation Language.
- DCL: Data Control Language.
- TCL: Transaction Control Language.
- Fact: Tabla de hechos con m√©tricas y FKs.
- Dimension: Tabla descriptiva usada para an√°lisis.
- Granularidad: Unidad de registro en una fact table.
- Cardinalidad: Relaci√≥n cuantitativa entre entidades.
- Surrogate Key: Clave artificial interna.
- Normalization: Proceso de estructurar tablas para evitar redundancia.

14 ‚Äî LECTURA R√ÅPIDA (PLANTILLA COPY-READY)
1. Localiza la tabla central (fact o entidad ancla).
2. Encuentra PKs (üîë) y FKs (üî∏).
3. Identifica la cardinalidad con Crow‚Äôs Foot.
4. Si Crow‚Äôs Foot en ambos lados ‚Üí tabla intermedia (N:M).
5. Revisa colores/etiquetas: üî¥ error, üü† revisar, üü¢ OK.
6. Verifica √≠ndices y columnas de JOIN/WHERE.
7. Resume en 1 frase la relaci√≥n principal.



